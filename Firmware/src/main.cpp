#include <Arduino.h>
#include <WiFi.h>

#include <wait_for_any_key.h>
#include "config/config.h"
#include "config/privateConfig.h"
#include "globals/globals.h"
#include "network/NetworkTask.h"

/*
 * ######################################################################################################################################
 * ######################################################################################################################################
 *                       V  A  R  I  A  B  L  E      D  E  F  I  N  A  I  T  O  N  S
 * ######################################################################################################################################
 * ######################################################################################################################################
 */



/*
 * ##################################################################################################
 * ##################################################################################################
 * ##################################################################################################
 * ##########################   f u n c t i o n    d e c l a r a t i o n s  #########################
 * ##################################################################################################
 * ##################################################################################################
 * ##################################################################################################

 Functions are now declared in their respective header files and only included here.
 Function definitions are in their respective .cpp files.
 
 .h and .cpp file structure: 
src/
 │── main.cpp          // setup() and loop()
 │── networks
 │── │── NetworkTask.h
 │── │── NetworkTask.cpp  // WiFi and network related functions
 │── ota
 |-- │── OtaService.h
 |-- │── OtaService.cpp   // OTA update related functions
 */



/*
 * ###################################################################################################
 * ###################################################################################################
 * ###################################################################################################
 * ###################   S E T U P      B e g i n     ################################################
 * ###################################################################################################
 * ###################################################################################################
 * ###################################################################################################
 */
void setup() {
  wait_for_any_key( SKETCH_VERSION);

  WiFi.begin("FIBERMEDIA-yb2f", "7cx3AdKg6N6LSA");
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  delay(1000);  // Give some time to settle WiFi connection
  if (WiFi.status() == WL_CONNECTED) {
    Serial.print("\nWiFi connected. IP address: ");
    Serial.println(WiFi.localIP());
    static TaskParams_t networkParams = { .sketchVersion = SKETCH_VERSION, .nvsNamespace = NVS_NAMESPACE };
    startNetworkTask( &networkParams );

  } else {
    Serial.println("\nWiFi connection failed.");
  } 
}

/*
 * ###################################################################################################
 * ###################################################################################################
 * ###################################################################################################
 *                       L O O P     B e g i n
 * ###################################################################################################
 * ###################################################################################################
 * ###################################################################################################
 */
void loop() {
  // put your main code here, to run repeatedly:
}
